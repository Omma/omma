{% extends "OmmaAppBundle::layout.html.twig" %}

{% block protocol_tab %}
    <h2>Protokoll zu dieser Veranstaltung</h2>
    {% if can_edit %}
        <div class="well" ng-show="protocol.final" ng-bind-html="protocol.text"></div>
        <div ng-hide="protocol.final">
            <div class="header-button" ng-switch on="status">
                <button ng-switch-when="not_saved" class="btn btn-primary"><span class="glyphicon glyphicon-file"></span> {{ "app.save"|trans }}</button>
                <button ng-switch-when="saving" class="btn btn-default disabled"><span class="glyphicon glyphicon-refresh"></span> {{ "app.saving"|trans }}</button>
                <button ng-switch-when="saved" class="btn btn-default disabled"><span class="glyphicon glyphicon-ok"></span> {{ "app.saved"|trans }}</button>
            </div>
            <p>Wenn Sie das Protokoll als "Final" markieren, ist es für alle Teilnehmer sichtbar. </p>
            <hr class="invisible" />

            <div text-angular-toolbar name="htmlcontenttools"></div>

            <div text-angular="text-angular" name="htmlcontent" ng-model="protocol.text" ta-disabled='disabled' placeholder='Hier können Sie Ihr Protokoll verfassen... ' ta-target-toolbars='htmlcontenttools,statictoolbar'></div>
            <hr class="invisible" />
            <div class="btn btn-primary {{ "{{ getButtonClass() }}" }}" data-toggle="modal" data-target=".protocolModal">Protokoll als "Final" markieren</div>
        </div>
        <!-- Todo Modal -->
        <div class="modal fade protocolModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            <span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Protokoll als "Final" markieren</h4>
                    </div>
                    <div class="modal-body">
                        Wollen Sie das Protokoll wirklich als "Final" markieren?<br>Diese Aktion kann nicht rückgängig gemacht werden, Änderungen sind nicht mehr möglich.
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Nein, doch nicht</button>
                        <button type="button" class="btn btn-primary" ng-click="deleteModal()" data-dismiss="modal">Ja, als "Final" markieren</button>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        {% if meeting.protocol %}
            <div class="well">
                {{ meeting.protocol.text }}
            </div>
        {% endif %}
    {% endif %}
{% endblock %}

{% block todo_tab %}
    <div class="btn btn-primary pull-right" ng-click="addNewTodo()"><i class="glyphicon glyphicon-plus"></i> </div>
    <h2>{{ "app.todos.title"|trans }}</h2>

    {% verbatim %}
    <hr class="invisible"/>

    <div ng-repeat="todo in todos">

        <div ng-class="{'done': todoIsDone(todo)}">
            <accordion close-others="oneAtATime">
                <accordion-group>

                    <accordion-heading>
                        <i class="fa" ng-class="{'fa-exclamation': todoIsImportant(todo)}"> </i>

                        {{ todo.task }}

                    </accordion-heading>


                    <div class="row">
                        <div class="col-xs-12"><i>{{ todo.description }}</i></div>




                    </div>
                    <hr />
                    <div class="row">
                        <div class="col-xs-3">

                            <input type="checkbox" ng-model="status" ng-change="">
                            <span class="bold">Erledigt</span><br><br>

                            <input type="checkbox" ng-model="priority" ng-change="">
                            <span class="bold">Wichtig</span>

                        </div>
                        <div class="col-xs-3">




                            <span class="bold">Zu erledigen bis</span>

                            <div class="form-group">
                                <div class="row">
                                    <div class="col-xs-12">
                                        <input date-picker class="form-control date-picker" type="text" date="date.endDate" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12" style="margin-top:35px;">
                                        <timepicker class="time-picker" ng-model="timepicker" ng-change="timeChange()" hour-step="1" minute-step="5" show-meridian="false"></timepicker>
                                    </div>
                                </div>
                            </div>



                        </div>
                        <div class="col-xs-6">
                            <span class="bold">Aufgabe einer Person zuordnen: </span>
                            <div class="row">
                                <div class="col-xs-10">
                                    <user-select selected="todo.user" ng-change="temp()" ng-model="user"></user-select>
                                </div>
                                <div class="col-xs-2">
                                    <div class="btn btn-primary pull-right" ng-click="addUser()"><i class="fa fa-plus"></i></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    <hr class="invisible"/>
                                    <hr class="invisible"/>
                                    <div data-toggle="modal" data-target=".todoModal" ng-click="setTempIdToDelete(todo.id)"><div class="btn btn-danger pull-right"><i class="fa fa-remove"></i></div></div>
                                </div>
                            </div>


                        </div>
                    </div>

                </accordion-group>
            </accordion>
        </div>

        {{ todo }}

        <br>
        selected User: {{ todo.user }}


    </div>


    <!-- Todo Modal -->
    <div class="modal fade todoModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">ToDo löschen</h4>
                </div>
                <div class="modal-body">
                    Wollen Sie diesen ToDo Punkt wirklich unwiderruflich löschen?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Nein, doch nicht</button>
                    <button type="button" class="btn btn-danger" ng-click="deleteModal()" data-dismiss="modal">Ja, löschen</button>
                </div>
            </div>
        </div>
    </div>



    {% endverbatim %}
{% endblock %}


{% block attendee_tab %}

{% endblock %}

{% block content %}
    <script type="text/ng-template" id="user_select.html">
        <ui-select ng-model="$parent.selected" theme="select2" class="form-control">
            <ui-select-match placeholder="{{ "app.user.search"|trans }}">
            {{ "{{ $select.selected.username}}" }}
            </ui-select-match>
            <ui-select-choices refresh="search($select.search)" refresh-delay="1000" repeat="item in users | filter: $select.search">
                <div ng-bind-html="item.username | highlight: $select.search"></div>
                <small>
                    <span ng-bind-html="item.firstname | highlight: $select.search"></span>
                    <span ng-bind-html="item.lastname | highlight: $select.search"></span>
                </small>
            </ui-select-choices>
        </ui-select>
    </script>

    <div ng-controller="meetingController" ng-init="init({{ meeting|serialize('json') }})">
        {% if can_edit %}
            <div class="pull-right">
                <a href="#" class="btn btn-danger" data-toggle="modal" data-target=".meetingModal">
                    <i class="glyphicon glyphicon-trash"></i> {{ "app.delete"|trans }}
                </a>
            </div>
            <div class="modal fade meetingModal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">
                                <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                            </button>
                            <h4 class="modal-title">{{ "app.general.delete.title"|trans }}</h4>
                        </div>
                        <div class="modal-body">
                            {{ "app.general.delete.confirmation"|trans }}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">{{ "app.cancel_modal"|trans }}</button>
                            <button type="button" class="btn btn-primary" ng-click="deleteMeeting()" data-dismiss="modal">{{ "app.general.delete.ok"|trans }}</button>
                        </div>
                    </div>
                </div>
            </div>
            {% verbatim %}
                <div class="meeting-name">
                    <h1 editable-text="meeting.name">
                        {{ meeting.name || "empty" }}
                    </h1>
                </div>
            {% endverbatim %}
        {% else %}
            <h1>{{ meeting.name }}</h1>
        {% endif %}
        <ul class="nav nav-tabs" data-tabs="tabs">
            <li class="active"><a href="#general" data-toggle="tab">{{ "app.general.title"|trans }}</a></li>
            <li><a href="#agenda" data-toggle="tab">{{ "app.agenda.title"|trans }}</a></li>
            <li><a href="#todos" data-toggle="tab">{{ "app.todos.title"|trans }}</a></li>
            <li><a href="#protocol" data-toggle="tab">{{ "app.protocol.title"|trans }}</a></li>
            <li><a href="#attendees" data-toggle="tab">{{ "app.attendees.title"|trans }}</a></li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane active" id="general" ng-controller="meetingGeneralController">
                {% if attendee is not null %}
                    {{ block('confirmation_form') }}
                {% endif %}
                <h2>{{ "app.general.title"|trans }}</h2>
                {% include "OmmaAppBundle:Meeting/Tab:general.html.twig" %}
            </div>
            <div class="tab-pane" id="agenda" ng-controller="meetingAgendaController">
                {% include "OmmaAppBundle:Meeting/Tab:agenda.html.twig" %}
            </div>
            <div class="tab-pane" id="todos" ng-controller="toDoController">
                {{ block('todo_tab') }}
            </div>
            <div class="tab-pane" id="protocol" ng-controller="protocolController">
                {{ block('protocol_tab') }}
            </div>
            <div class="tab-pane" id="attendees" ng-controller="meetingAttendeeController">
                {% include "OmmaAppBundle:Meeting/Tab:attendees.html.twig" %}
            </div>
        </div>
    </div>
{% endblock %}

{% block confirmation_form %}
    <h2>{{ "app.confirmation.title"|trans }}</h2>
    {% if attendee.status == 'invited' %}
        <div class="alert alert-info" role="alert">
            {{ "app.confirmation.info"|trans }}
        </div>
    {% endif %}
    {{ form_start(attendeeForm) }}
    {{ form_rest(attendeeForm) }}
    <div class="form-group">
        <div class="col-sm-offset-3 col-sm-9">
            <button type="submit" class="btn btn-primary">
                <i class="glyphicon glyphicon-file"></i> {{ "app.save"|trans }}
            </button>
        </div>
    </div>
    {{ form_end(attendeeForm) }}
{% endblock %}
