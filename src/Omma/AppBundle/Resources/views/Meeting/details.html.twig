{% extends "OmmaAppBundle::layout.html.twig" %}

{% block agenda_tab %}
    {% if can_edit %}
        <div class="header-button" ng-switch on="status">
            <button ng-switch-when="not_saved" class="btn btn-primary" ng-click="saveTree()"><span class="glyphicon glyphicon-file"></span> {{ "app.save"|trans }}</button>
            <button ng-switch-when="saving" class="btn btn-default disabled" ng-click="saveTree()"><span class="glyphicon glyphicon-refresh"></span> {{ "app.saving"|trans }}</button>
            <button ng-switch-when="saved" class="btn btn-default disabled" ng-click="saveTree()"><span class="glyphicon glyphicon-ok"></span> {{ "app.saved"|trans }}</button>
        </div>
    {% endif %}
    <h2>{{ "app.agenda.title"|trans }}</h2>
    <!-- Nested node template -->
    <script type="text/ng-template" id="nodes_renderer.html">
        <div ui-tree-handle>
            <form class="form-inline" role="form" ng-show="node.editing">
                <div class="form-group">
                    <label class="sr-only" for="name">Name</label>
                    <input type="text" class="form-control" placeholder="Name" ng-model="node.name">
                </div>
                <button type="submit" class="btn btn-default" ng-click="save(node)">Save</button>
                <button type="submit" class="btn btn-default" ng-click="cancelEditing(node)">Cancel</button>
            </form>
            <div ng-show="!node.editing">
                {{ "{{ node.name }}" }}
                <div class="pull-right">
                    <a href="" class="btn btn-success btn-xs" data-nodrag ng-click="newNode(node)"><span class="glyphicon glyphicon-plus"></span></a>
                    <a href="" class="btn btn-primary btn-xs" data-nodrag ng-click="edit(node)"><i class="glyphicon glyphicon-pencil"></i></a>
                    <a href="" class="btn btn-danger btn-xs" data-nodrag ng-click="remove(this)"><span class="glyphicon glyphicon-remove"></span></a>
                </div>
            </div>
        </div>
        <ol ui-tree-nodes="" ng-model="node.children">
            <li ng-repeat="node in node.children" ui-tree-node ng-include="'nodes_renderer.html'">
            </li>
        </ol>
    </script>
    <div ui-tree>
        <ol ui-tree-nodes="" ng-model="rootAgenda.children" id="tree-root">
            <li ng-repeat="node in rootAgenda.children" ui-tree-node ng-include="'nodes_renderer.html'"></li>
        </ol>
        <a href="" class="btn btn-success btn-xs" data-nodrag ng-click="newNode(rootAgenda)" style="margin-top: 10px"><span class="glyphicon glyphicon-plus"></span></a>
    </div>
{% endblock %}

{% block protocol_tab %}
    {% verbatim %}
    <h2>Protokoll zu dieser Veranstaltung</h2>
    <p>Wenn Sie das Protokoll als "final" markieren, ist es für alle Teilnehmer sichtbar. </p>
    <hr class="invisible" />
    <span class="status">{{ status }}</span>
    <div text-angular-toolbar name="htmlcontenttools"></div>
    <div text-angular="text-angular" name="htmlcontent" ng-model="orightml" ta-disabled='disabled' placeholder='Hier können Sie Ihr Protokoll verfassen... ' ta-target-toolbars='htmlcontenttools,statictoolbar'></div>
    <hr class="invisible" />
    <div class="btn btn-primary omma-ask {{ getButtonClass() }}">Protokoll als "final" markieren</div>
    <div class="btn btn-info omma-cancel">Nein, doch nicht</div>
    <div class="btn btn-danger omma-do">Ja, als "final" markieren</div>
    {% endverbatim %}
{% endblock %}

{% block attendee_tab %}
    <h2>{{ "app.attendees.title"|trans }}</h2>
    {% if can_edit %}
    <form role="form">
        <div class="form-group">
            <div class="row">
                <div class="col-md-6">
                    <user-select selected="selectedUser"></user-select>
                </div>
                <div class="col-md-6">
                    <button ng-click="addUser()" class="btn btn-success"><i class="glyphicon glyphicon-plus"></i></button>
                </div>
            </div>
        </div>
    </form>
    {% endif %}
    <table class="table table-hover">
        <thead>
        <tr>
            <th style="width: 20px">-</th>
            <th>{{ "app.attendees.user"|trans }}</th>
            {% if can_edit %}
                <th>{{ "app.options"|trans }}</th>
            {% endif %}
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="attendee in attendees">
            <td ng-switch on="attendee.status">
                <i ng-switch-when="invited" class="glyphicon glyphicon-time" data-toggle="tooltip" title="Invited"></i>
                <i ng-switch-when="accepted" class="glyphicon glyphicon-ok-sign"></i>
                <i ng-switch-when="declined" class="glyphicon glyphicon-remove-sign"></i>
                <i ng-switch-when="maybe" class="glyphicon glyphicon-question-sign"></i>
            </td>
            <td>
                {{ "{{ attendee.user.username }}" }}
                <span ng-show="attendee.owner" class="label label-primary">
                    {{ "app.attendees.organizer"|trans }}
                </span>
            </td>
            {% if can_edit %}
            <td>
                <a class="btn btn-xs btn-danger" ng-click="removeAttendee(attendee)" ng-hide="attendee.owner"><i class="glyphicon glyphicon-remove"></i></a>
            </td>
            {% endif %}
        </tr>
        </tbody>
    </table>
{% endblock %}

{% block content %}
    <script type="text/ng-template" id="user_select.html">
        <ui-select ng-model="$parent.selected" theme="select2" class="form-control">
            <ui-select-match placeholder="{{ "app.user.search"|trans }}">
            {{ "{{ $select.selected.username}}" }}
            </ui-select-match>
            <ui-select-choices refresh="search($select.search)" refresh-delay="1000" repeat="item in users | filter: $select.search">
                <div ng-bind-html="item.username | highlight: $select.search"></div>
                <small>
                    <span ng-bind-html="item.firstname | highlight: $select.search"></span>
                    <span ng-bind-html="item.lastname | highlight: $select.search"></span>
                </small>
            </ui-select-choices>
        </ui-select>
    </script>

    <div ng-controller="meetingController" ng-init="init({{ meeting|serialize('json') }})">
        {% verbatim %}
            <div class="meeting-name">
                <h1 editable-text="meeting.name">
                    {{ meeting.name || "empty" }}
                </h1>
            </div>
        {% endverbatim %}
        <ul class="nav nav-tabs" data-tabs="tabs">
            {% if not owner %}
            <li{% if not owner %} class="active"{% endif %}><a href="#confirmation" data-toggle="tab">{{ "app.confirmation.title"|trans }}</a></li>
            {% endif %}
            <li{% if owner %} class="active"{% endif %}><a href="#settings" data-toggle="tab">{{ "app.date.title"|trans }}</a></li>
            <li><a href="#agenda" data-toggle="tab">{{ "app.agenda.title"|trans }}</a></li>
            <li><a href="#todos" data-toggle="tab">{{ "app.todos.title"|trans }}</a></li>
            <li><a href="#protocol" data-toggle="tab">{{ "app.protocol.title"|trans }}</a></li>
            <li><a href="#attendees" data-toggle="tab">{{ "app.attendees.title"|trans }}</a></li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane{% if not owner %} active{% endif %}" id="confirmation">
                {{ block('confirmation_tab') }}
            </div>
            <div class="tab-pane{% if owner %} active{% endif %}" id="settings">
                <h2>{{ "app.date.title"|trans }}</h2>
            </div>
            <div class="tab-pane" id="agenda" ng-controller="meetingAgendaController">
                {{ block('agenda_tab') }}
            </div>
            <div class="tab-pane" id="todos">
                <h2>{{ "app.todos.title"|trans }}</h2>

                    <ul class="nav nav-tabs nav-justified" data-tabs="tabs">
                        <li class="active"><a href="#meine-todos" data-toggle="tab">Meine Todos</a></li>
                        <li><a href="#allgemein" data-toggle="tab">Allgemeine Todos</a></li>
                    </ul>

                    <div class="tab-content">
                        <div class="tab-pane active" id="meine-todos">
                            <h3>meine-todos</h3>
                        </div>
                        <div class="tab-pane" id="allgemein">
                            <h3>allgemein-todos</h3>
                        </div>
                    </div>
            </div>
            <div class="tab-pane" id="protocol" ng-controller="protocolController">
                {{ block('protocol_tab') }}
            </div>
            <div class="tab-pane" id="attendees" ng-controller="meetingAttendeeController">
                {{ block('attendee_tab') }}
            </div>
        </div>
    </div>
{% endblock %}

{% block confirmation_tab %}
    <h2>{{ "app.confirmation.title"|trans }}</h2>
    {% if attendee.status == 'invited' %}
        <div class="alert alert-info" role="alert">
            {{ "app.confirmation.info"|trans }}
        </div>
    {% endif %}
    {{ form_start(attendeeForm) }}
    {{ form_rest(attendeeForm) }}
    <div class="form-group">
        <div class="col-sm-offset-3 col-sm-9">
            <button type="submit" class="btn btn-primary">
                <i class="glyphicon glyphicon-file"></i> {{ "app.save"|trans }}
            </button>
        </div>
    </div>
    {{ form_end(attendeeForm) }}
{% endblock %}
